{"version":3,"sources":["services/internationalization-explorer.service.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,2CAA4C;AAE5C,mCAAqC;AACrC,oDAAyD;AACzD,oEAAgE;AAEhE,4CAAiD;AAGjD,IAAa,mCAAmC,GAAhD;IAGI,YACqB,gBAAkC,EAClC,eAAgC;QADhC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,oBAAe,GAAf,eAAe,CAAiB;QAJ7C,aAAQ,GAAG,6BAAiB,CAAC;IAMrC,CAAC;IAEM,OAAO;QACV,MAAM,UAAU,GAAG,CAAE,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAE,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAE1F,OAAO,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,CAAC;IAC9E,CAAC;IASS,eAAe,CAAC,QAAQ,EAAE,SAAS,EAAE,UAAkB;QAC7D,MAAM,QAAQ,GAAG,SAAS,CAAE,UAAU,CAAE,CAAC;QAEzC,OAAO;YACH,IAAI,EAAE,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC;YAClD,UAAU;SACb,CAAC;IACN,CAAC;IAEM,aAAa,CAAC,QAA6B;QAC9C,MAAM,SAAS,GAAG,MAAM,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAClD,MAAM,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,iBAAiB,CACrD,QAAQ,EACR,SAAS,EACT,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,CAC1D,CAAC;QAEF,OAAO,UAAU;aACZ,MAAM,CAAC,SAAS,CAAC,EAAE;YAChB,OAAO,SAAS,CAAC,IAAI,IAAI,SAAS,CAAC,UAAU,CAAC;QAClD,CAAC,CAAC;aACD,GAAG,CAAC,SAAS,CAAC,EAAE;YACb,MAAM,QAAQ,GAAG,QAAQ,CAAE,SAAS,CAAC,UAAU,CAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAEjE,uBACI,QAAQ,IACL,SAAS,EACd;QACN,CAAC,CAAC,CAAC;IACX,CAAC;IAOS,OAAO,CAAC,UAAgC,EAAE,QAAkD;QAClG,OAAO,oBAAW,CACd,UAAU,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,CACvB,CAAE,GAAG,SAAS,CAAC,MAAM,EAAE,CAAE,CAAC,GAAG,CAAC,CAAC,EAAE,QAAQ,EAAE,EAAE,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CACtE,CACJ,CAAC;IACN,CAAC;CACJ,CAAA;AAjEY,mCAAmC;IAD/C,mBAAU,EAAE;qCAK8B,2BAAgB;QACjB,kCAAe;GAL5C,mCAAmC,CAiE/C;AAjEY,kFAAmC","file":"internationalization-explorer.service.js","sourcesContent":["import { Injectable } from \"@nestjs/common\";\nimport { Injectable as InjectableInterface } from \"@nestjs/common/interfaces\";\nimport { flattenDeep } from \"lodash\";\nimport { ModulesContainer } from \"@nestjs/core/injector\";\nimport { MetadataScanner } from \"@nestjs/core/metadata-scanner\";\nimport { PhraseMetadata } from \"../metadatas\";\nimport { PHRASE_DEFINITION } from \"../constants\";\n\n@Injectable()\nexport class InternationalizationExplorerService {\n    private metadata = PHRASE_DEFINITION;\n\n    constructor(\n        private readonly modulesContainer: ModulesContainer,\n        private readonly metadataScanner: MetadataScanner,\n    ) {\n    }\n\n    public explore(): Array<PhraseMetadata> {\n        const components = [ ...this.modulesContainer.values() ].map(module => module.components);\n\n        return this.flatMap(components, instance => this.filterPhrases(instance));\n    }\n\n    /**\n     * @param instance\n     * @param prototype\n     * @param { string } methodName\n     *\n     * @returns { DashboardMetadata }\n     */\n    protected extractMetadata(instance, prototype, methodName: string): PhraseMetadata {\n        const callback = prototype[ methodName ];\n\n        return {\n            name: Reflect.getMetadata(this.metadata, callback),\n            methodName,\n        };\n    }\n\n    public filterPhrases(instance: InjectableInterface): Array<PhraseMetadata> {\n        const prototype = Object.getPrototypeOf(instance);\n        const components = this.metadataScanner.scanFromPrototype(\n            instance,\n            prototype,\n            name => this.extractMetadata(instance, prototype, name),\n        );\n\n        return components\n            .filter(dashboard => {\n                return dashboard.name && dashboard.methodName;\n            })\n            .map(dashboard => {\n                const callback = instance[ dashboard.methodName ].bind(instance);\n\n                return {\n                    callback,\n                    ...dashboard,\n                };\n            });\n    }\n\n    /**\n     * @param { Map<any, any>[] } components\n     * @param { (instance: any) => Array<PhraseMetadata> } callback\n     * @returns { any }\n     */\n    protected flatMap(components: Array<Map<any, any>>, callback: (instance: any) => Array<PhraseMetadata>) {\n        return flattenDeep<PhraseMetadata>(\n            components.map(component =>\n                [ ...component.values() ].map(({ instance }) => callback(instance)),\n            ),\n        );\n    }\n}\n"]}