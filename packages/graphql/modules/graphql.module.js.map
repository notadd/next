{"version":3,"sources":["modules/graphql.module.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,iDAAiD;AACjD,kDAAqD;AACrD,6CAAgD;AAChD,iEAAwE;AACxE,4CAA8C;AAE9C,2CAAwC;AAWxC,IAAa,aAAa,GAA1B;IAMI,YAA6B,cAA8B;QAA9B,mBAAc,GAAd,cAAc,CAAgB;QALnD,kBAAa,GAAyB,uBAAa,CAAC,wBAAwB,EAAE,CAAC;IAMvF,CAAC;IAKD,SAAS,CAAC,QAA6B;QACnC,MAAM,MAAM,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QACnC,IAAI,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,EAAE;YAC/B,QAAQ;iBACH,KAAK,CAAC,uCAAe,CAAC,EAAE,WAAW,EAAE,IAAI,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;iBAC1E,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;SACnD;QACD,QAAQ;aACH,KAAK,CAAC,sCAAc,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;aAC1D,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IAChD,CAAC;IAED,YAAY;QACR,MAAM,KAAK,GAAkB,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,MAAM,CAAC,EAC5D,CAAC,CAAC;QACH,MAAM,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAE9D,OAAO,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC;YACpC,QAAQ;YACR,SAAS,EAAE;gBACP,IAAI,EAAE,WAAW;aACpB;SACJ,CAAC,CAAC;IACP,CAAC;CACJ,CAAA;AApCY,aAAa;IARzB,eAAM,CAAC;QACJ,UAAU,EAAE;YACR,0BAAc;SACjB;QACD,OAAO,EAAE;YACL,uBAAa;SAChB;KACJ,CAAC;qCAO+C,0BAAc;GANlD,aAAa,CAoCzB;AApCY,sCAAa","file":"graphql.module.js","sourcesContent":["import * as GraphQLJSON from \"graphql-type-json\";\nimport { Configuration } from \"@notadd/core/loaders\";\nimport { GraphQLModule } from \"@nestjs/graphql\";\nimport { graphiqlExpress, graphqlExpress } from \"apollo-server-express\";\nimport { GraphqlFactory } from \"../factories\";\nimport { MiddlewaresConsumer } from \"@nestjs/common/interfaces/middlewares\";\nimport { Module } from \"@nestjs/common\";\nimport { GraphqlConfiguration } from \"@notadd/core/configurations/graphql.configuration\";\n\n@Module({\n    components: [\n        GraphqlFactory,\n    ],\n    imports: [\n        GraphQLModule,\n    ],\n})\nexport class GraphqlModule {\n    private configuration: GraphqlConfiguration = Configuration.loadGraphqlConfiguration();\n\n    /**\n     * @param { GraphqlFactory } graphQLFactory\n     */\n    constructor(private readonly graphQLFactory: GraphqlFactory) {\n    }\n\n    /**\n     * @param { MiddlewaresConsumer } consumer\n     */\n    configure(consumer: MiddlewaresConsumer) {\n        const schema = this.createSchema();\n        if (this.configuration.ide.enable) {\n            consumer\n                .apply(graphiqlExpress({ endpointURL: `/${this.configuration.endpoint}` }))\n                .forRoutes(this.configuration.ide.endpoint);\n        }\n        consumer\n            .apply(graphqlExpress(req => ({ schema, rootValue: req })))\n            .forRoutes(this.configuration.endpoint);\n    }\n\n    createSchema() {\n        const paths: Array<string> = this.configuration.paths.concat([\n        ]);\n        const typeDefs = this.graphQLFactory.mergeTypesByPaths(paths);\n\n        return this.graphQLFactory.createSchema({\n            typeDefs,\n            resolvers: {\n                Json: GraphQLJSON,\n            },\n        });\n    }\n}\n"]}